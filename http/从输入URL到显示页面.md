# 1⃣️ 对比浏览器缓存

**先来看一张图**
![浏览器缓存对比](http://www.alloyteam.com/wp-content/uploads/2016/03/%E5%9B%BE%E7%89%8761.png)
> **Etag**  
> Etag是资源的特定版本的标识符。它是位于双引号之间的ASCII字符串，如（“675af34563dc-tr34”）。

当缓存过期的时候，优先判断响应头是否有`Etag`.  如果有的话，请求将包值为`Etag`的`If-None-Match`头`If-Nonw-Match: "33a64df551425fcc55e4d42a148795d9f25f89d4"`来与服务器当前的资源的`Etag`进行比较，如果两个值匹配（即资源未更改），服务器将返回不带任何内容的304告知客户端资源缓存版本可用，否则返回200。

> **Last-modified**

服务器端文件最后的修改时间。如果没有`Etag`,则判断是否有`Last-modified`。当浏览器请求时，会向服务器传送`If-modified-since`报头，询问资源是否被修改。如果没有修改，返回304。否则返回200。

> **Cache-Control**

- [ ] `max-age`指定设置缓存最大的有效时间。当浏览器向服务器发送请求后，在max-age这段时间里浏览器就不会再向服务器发送请求了。
- [ ] `s-maxage`只用于共享缓存。如CDN缓存。比如，当`s-maxage=60`时，在这60秒中，即使更新了CDN的内容，浏览器也不会进行请求。也就是说`max-age`用于普通缓存，而`s-maxage`用于代理缓存。如果存在`s-maxage`，则会覆盖掉`max-age`和`Expires header`。
- [ ] `public`指定响应会被缓存，并且共享。可以被任何对象（包括：客户端，代理等）缓存。
- [ ] `private`表明响应只能被单个用户缓存，不能共享。即代理服务器不能缓存。

> **Expires**  
> 缓存过期时间，是一个指定的时间点。

**综上就是浏览器缓存的判断机制。如果有缓存，直接从缓存中读取对应的文件**

# 2⃣️ DNS解析

**DNS解析就是寻找哪台机器上有资源的过程。所以我们需要找到这个计算机。而互联网上计算机的唯一标识就是它的IP地址。DNS解析就是将网址解析为对应IP的过程。**
![DNS解析过程](https://image-static.segmentfault.com/161/828/1618288278-57f00bf9444dd_articlex)
**以上这么多过程，耗时太久。DNS缓存和DNS均衡负载就是为了优化这个查询的过程**
> **DNS缓存**  

DNS存在着多级缓存。从离浏览器的距离排列，有：浏览器缓存，系统缓存，路由器缓存，IPS服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。

> **DNS均衡负载**

用脚趾头都能想到，一个资源肯定不是只在一个指定的IP计算机上。因为亿万级的请求，扛不住。DNS可以返回一个合适的IP的机器给用户。根据用户的地理位置，机器的负载量等等因素，保证最优化。CDN就是利用了这种技术。

# 3⃣️ 三次握手建立TCP连接
![三次握手](https://upload-images.jianshu.io/upload_images/3160413-5a9f596e6bde10c6.png)
为什么需要进行三次握手，而不是两次握手？原因是两次握手不可靠。比如，浏览器发送一个连接请求包A，但包A在半路上堵车了，浏览器就认为包A丢失了，所以重新发生一个请求包B给服务器。服务器收到请求，建立连接。两端进行通信，结束后关闭连接。但是这时候，包A到达了服务器，服务器不知道这是一个无效的包，所以进行响应。这时两次握手已经完成，两端就建立起一个无效的连接。但浏览器认为自己没发出请求，所以不会回应，这样就让服务器白白等待回应，浪费了服务器资源。而三次握手的机制下，浏览器知道自己并没有请求连接，会发送拒绝包给服务器，服务器收到回应后也会结束这次无效的连接。

# 4⃣️ 浏览器向服务器发送HTTP请求

发送HTTP请求的过程就是构建HTTP请求报文并通过TCP协议发送到服务器指定端口。HTTP请求报文由三部分组成。
> 第一部分：请求行

格式举例：`GET index.html HTTP/1.1`  
常用的方法有：GET和POST.
- [ ] `GET：从指定的资源请求数据`
    - 可被缓存。指绝大多数情况，GET请求的响应可以被缓存。设计上GET请求就是从服务器获取资源给客户端使用，为了减少服务器压力和请求次数，GET请求被设计为可缓存。
    - GET请求可以保存在浏览器历史记录中，可以被存标签。（感觉没什么用，然后为什么？）
    - GET请求在URL中发送的，所以不能用于处理敏感数据。
    - GET请求有长度限制
- [ ] `POST：向指定的资源提交数据`
    - 不可被缓存。指绝大多数情况，POST请求的响应不可以被客户端缓存。设计上POST请求是向服务器提交数据的。规范里面规定了服务器返回的HTTP状态码不可以是304.不过这并不代表POST就一定不能被缓存。如果在POST请求对应的响应中包含`Freshness`的相关信息的话，这次响应也可以被缓存。
    - POST请求不可以保存在浏览器历史记录中，不可以被存标签。（感觉没什么用，然后为什么？）
    - POST请求是在HTTP主体中发送的，用于需要保密的数据处理。
    - POST请求没有长度限制

> 第二部分：请求报头